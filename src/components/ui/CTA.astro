---
import { getAffiliateById, ctaMessages } from '@data/affiliate-links';

interface Props {
  type?: 'succession' | 'heritage' | 'donation' | 'testament' | 'droits' | 'notaire';
  title?: string;
  description?: string;
  affiliateId?: string;
  variant?: 'default' | 'compact' | 'inline';
}

const { type = 'succession', title, description, affiliateId, variant = 'default' } = Astro.props;

const ctaConfig = ctaMessages[type] || ctaMessages.succession;
const affiliate = getAffiliateById(affiliateId || ctaConfig?.affiliateId);

const displayTitle = title || ctaConfig?.title || 'Besoin d\'aide ?';
const displayDescription = description || ctaConfig?.description || 'Consultez un professionnel pour votre situation.';
---

{variant === 'default' && (
  <aside class="cta-box">
    <h3>{displayTitle}</h3>
    <p>{displayDescription}</p>
    {affiliate && (
      <a
        href={affiliate.url}
        class="inline-flex items-center px-6 py-3 bg-white text-primary-700 font-semibold rounded-lg hover:bg-primary-50 transition-colors"
        rel="noopener sponsored"
        target="_blank"
      >
        {affiliate.cta}
        <svg class="w-5 h-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    )}
  </aside>
)}

{variant === 'compact' && (
  <aside class="bg-primary-50 border border-primary-200 rounded-xl p-6 my-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h4 class="font-semibold text-secondary-900">{displayTitle}</h4>
        <p class="text-sm text-secondary-600 mt-1">{displayDescription}</p>
      </div>
      {affiliate && (
        <a
          href={affiliate.url}
          class="btn-primary whitespace-nowrap text-sm"
          rel="noopener sponsored"
          target="_blank"
        >
          {affiliate.cta}
        </a>
      )}
    </div>
  </aside>
)}

{variant === 'inline' && affiliate && (
  <a
    href={affiliate.url}
    class="inline-flex items-center text-primary-600 hover:text-primary-700 font-medium"
    rel="noopener sponsored"
    target="_blank"
  >
    {affiliate.cta}
    <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
    </svg>
  </a>
)}
