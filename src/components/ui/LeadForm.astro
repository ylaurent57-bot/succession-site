---
interface Props {
  title?: string;
  description?: string;
  submitText?: string;
  source?: string;
}

const {
  title = 'Recevez nos conseils gratuits',
  description = 'Inscrivez-vous pour recevoir nos guides et conseils sur la succession directement dans votre boîte mail.',
  submitText = "S'inscrire",
  source = 'default',
} = Astro.props;
---

<aside class="bg-secondary-50 rounded-xl p-6 md:p-8 my-8">
  <h3 class="text-xl font-bold text-secondary-900 mb-2">{title}</h3>
  <p class="text-secondary-600 mb-6">{description}</p>

  <form
    action="/api/subscribe"
    method="POST"
    class="space-y-4"
    id="lead-form"
  >
    <input type="hidden" name="source" value={source} />

    <div>
      <label for="email" class="sr-only">Adresse email</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        placeholder="Votre adresse email"
        class="w-full px-4 py-3 rounded-lg border border-secondary-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 outline-none transition-all"
      />
    </div>

    <div class="flex items-start gap-3">
      <input
        type="checkbox"
        id="consent"
        name="consent"
        required
        class="mt-1 w-4 h-4 text-primary-600 border-secondary-300 rounded focus:ring-primary-500"
      />
      <label for="consent" class="text-sm text-secondary-600">
        J'accepte de recevoir des informations par email et je reconnais avoir pris connaissance de la
        <a href="/confidentialite/" class="text-primary-600 hover:underline">politique de confidentialité</a>.
      </label>
    </div>

    <button type="submit" class="btn-primary w-full">
      {submitText}
    </button>
  </form>

  <p class="text-xs text-secondary-500 mt-4 text-center">
    Vous pouvez vous désinscrire à tout moment.
  </p>
</aside>

<script>
  const form = document.getElementById('lead-form') as HTMLFormElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const button = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = button.textContent;

    button.textContent = 'Envoi en cours...';
    button.disabled = true;

    // Simuler l'envoi (remplacer par votre API)
    await new Promise((resolve) => setTimeout(resolve, 1000));

    // Succès
    form.innerHTML = `
      <div class="text-center py-4">
        <svg class="w-12 h-12 text-green-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <p class="text-lg font-semibold text-secondary-900">Merci pour votre inscription !</p>
        <p class="text-secondary-600 mt-2">Vous recevrez bientôt nos conseils.</p>
      </div>
    `;
  });
</script>
